<script>
    const SHEET_ID = '12eyXAI9-hT0TFSx2HhVDUWHXo4X9QVT-vSPmGQBx6c8';
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;
    
    let videoData = [];

    async function init() {
        const statusText = document.getElementById('status-text');
        const grid = document.getElementById('video-grid');

        try {
            const res = await fetch(SHEET_URL);
            const text = await res.text();
            // Clean the Google JSON wrapper
            const json = JSON.parse(text.substring(47).slice(0, -2));
            const rows = json.table.rows;

            videoData = rows.map((row, index) => {
                if (index === 0) return null; // Skip headers
                
                // DATA MAPPING (Matches your provided row)
                return {
                    title: row.c[1] ? row.c[1].v : "Untitled",    // Column B
                    category: row.c[2] ? row.c[2].v : "General", // Column C
                    thumb: row.c[4] ? row.c[4].v : "",           // Column E (Thumbnail)
                    preview: row.c[5] ? row.c[5].v : "",         // Column F (Preview)
                    price: row.c[6] ? row.c[6].v : "10"          // Column G (Price)
                };
            }).filter(v => v !== null);

            renderGrid(videoData);
            statusText.innerText = "Collection Sync Complete";
            statusText.className = "text-green-600 font-bold mb-8";

        } catch (err) {
            console.error("Fetch error:", err);
            statusText.innerText = "Connection Failed. Check Sheet Sharing.";
        }
    }

    function renderGrid(data) {
        const grid = document.getElementById('video-grid');
        grid.innerHTML = '';

        data.forEach(video => {
            const card = document.createElement('div');
            card.className = "cursor-pointer bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-xl transition-all border border-gray-100 group";
            card.innerHTML = `
                <div class="relative aspect-video bg-gray-100 overflow-hidden">
                    <img src="${video.thumb}" 
                         class="w-full h-full object-cover transition duration-500 group-hover:scale-110" 
                         onerror="this.src='https://via.placeholder.com/600x400?text=Check+GCP+Permissions'">
                    <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all flex items-center justify-center">
                         <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition shadow-xl">
                            <svg class="w-6 h-6 text-blue-600 ml-1" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                        </div>
                    </div>
                </div>
                <div class="p-5 text-left">
                    <h4 class="font-bold text-gray-800 truncate">${video.title}</h4>
                    <div class="flex justify-between items-center mt-1">
                        <p class="text-[10px] text-blue-600 font-black uppercase tracking-widest">${video.category}</p>
                        <p class="font-bold text-gray-900">$${video.price}</p>
                    </div>
                </div>
            `;
            card.onclick = () => openPreview(video);
            grid.appendChild(card);
        });
    }

    function openPreview(video) {
        const modal = document.getElementById('previewModal');
        const videoPlayer = document.getElementById('modalVideo');
        document.getElementById('modalTitle').innerText = video.title;
        videoPlayer.src = video.preview;
        modal.classList.remove('modal-hidden');
        modal.classList.add('modal-visible');
        videoPlayer.play();
    }

    function closeModal() {
        const modal = document.getElementById('previewModal');
        document.getElementById('modalVideo').pause();
        modal.classList.remove('modal-visible');
        modal.classList.add('modal-hidden');
    }

    init();
</script>
