<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nmediaservices Stockflow | Premium Footage Marketplace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Custom Scrollbar for Purchase History */
        #historyList::-webkit-scrollbar {
            width: 6px;
        }
        #historyList::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        #historyList::-webkit-scrollbar-thumb {
            background: #14B8A6;
            border-radius: 10px;
        }
        .modal-content {
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-900">

    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <img src="./assets/logo.png" alt="Nmediaservices Logo"
                     class="h-10 w-auto max-w-[150px]" onerror="this.style.display='none'">
                <h1 class="text-xl font-bold tracking-tight text-gray-900">
                    Nmediaservices<span class="text-teal-500">Stockflow</span>
                </h1>
            </div>

            <div id="walletWidget">
                <button id="loginButton" onclick="showLoginModal()"
                    style="background:#14B8A6;color:white;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:bold;">
                    Sign In
                </button>

                <div id="walletDisplay" style="display:none;">
                    <div style="display:flex;align-items:center;gap:15px;">
                        <div style="background:#E0F2FE;padding:8px 15px;border-radius:6px;">
                            <span style="font-size:14px;color:#0369A1;">Wallet:</span>
                            <strong id="walletAmount" style="color:#14B8A6;font-size:18px;">$0.00</strong>
                        </div>

                        <button onclick="showPurchaseHistory()"
                            style="background:#F3F4F6;color:#374151;padding:8px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:bold; transition: 0.2s hover;">
                            üìú My Purchases
                        </button>

                        <button onclick="showTopUpModal()"
                            style="background:#14B8A6;color:white;padding:8px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:bold;">
                            Add Funds
                        </button>
                        
                        <div style="position:relative;">
                            <button id="userMenuButton" onclick="toggleUserMenu()"
                                style="background:#F3F4F6;padding:8px 12px;border:none;border-radius:6px;cursor:pointer;">
                                <span id="userEmailDisplay"></span> ‚ñº
                            </button>
                            <div id="userMenu"
                                style="display:none;position:absolute;right:0;top:100%;margin-top:5px;background:white;border:1px solid #E5E7EB;border-radius:6px;box-shadow:0 4px 6px rgba(0,0,0,0.1);min-width:200px;z-index:100;">
                                <a href="#" onclick="logout();return false;"
                                    style="display:block;padding:10px 15px;color:#EF4444;text-decoration:none;">
                                    üö™ Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <header class="bg-gradient-to-br from-teal-500 to-teal-700 text-white py-20 px-6">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-5xl font-extrabold mb-4 tracking-tight">Premium Stock Footage</h2>
            <p class="text-xl text-teal-100 mb-8">Discover high-quality videos for your creative projects</p>
            <div class="relative max-w-2xl mx-auto">
                <input type="text" id="searchInput"
                    placeholder="Search footage by title, description, or tags..."
                    class="w-full px-6 py-4 pr-32 rounded-full text-gray-900 text-lg focus:outline-none focus:ring-4 focus:ring-teal-300 shadow-xl"
                    oninput="filterVideos()">
                <button class="absolute right-2 top-2 bg-teal-600 text-white px-8 py-2 rounded-full font-semibold hover:bg-teal-700 transition">
                    Search
                </button>
            </div>
        </div>
    </header>

    <div class="bg-white border-b border-gray-200 sticky top-[73px] z-40 shadow-sm">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="mb-4">
                <div class="flex items-center justify-between mb-3">
                    <p class="text-sm font-bold text-gray-700 uppercase tracking-wide">Browse Categories</p>
                    <p class="text-xs text-gray-500" id="resultCount">Loading...</p>
                </div>
                <div class="flex flex-wrap gap-2" id="categoryButtons"></div>
            </div>

            <div id="subcategorySection" class="mb-4 hidden">
                <div class="bg-teal-50 border border-teal-200 rounded-xl p-4">
                    <p class="text-sm font-semibold text-teal-800 mb-3" id="subcategoryTitle">Subcategories</p>
                    <div class="flex flex-wrap gap-2" id="subcategoryButtons"></div>
                </div>
            </div>

            <div id="subSection" class="mb-4 hidden">
                <div class="bg-purple-50 border border-purple-200 rounded-xl p-4">
                    <p class="text-sm font-semibold text-purple-800 mb-3" id="subTitle">Types</p>
                    <div class="flex flex-wrap gap-2" id="subButtons"></div>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <p class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Format</p>
                <div class="flex gap-2">
                    <button class="format-btn active px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-100 text-gray-700 hover:bg-teal-500 hover:text-white transition"
                            data-format="all" onclick="filterByFormat('all')">All</button>
                    <button class="format-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-100 text-gray-700 hover:bg-teal-500 hover:text-white transition"
                            data-format="9:16" onclick="filterByFormat('9:16')">üì± 9:16</button>
                    <button class="format-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-100 text-gray-700 hover:bg-teal-500 hover:text-white transition"
                            data-format="16:9" onclick="filterByFormat('16:9')">üñ•Ô∏è 16:9</button>
                    <button class="format-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-100 text-gray-700 hover:bg-teal-500 hover:text-white transition"
                            data-format="1:1" onclick="filterByFormat('1:1')">‚¨ú 1:1</button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-6 py-4">
        <p id="status-text" class="text-sm text-gray-500">
            <span class="inline-block w-2 h-2 bg-teal-500 rounded-full animate-pulse mr-2"></span>
            Loading footage...
        </p>
    </div>

    <main class="max-w-7xl mx-auto px-6 pb-16">
        <div id="video-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
        <div id="loadMoreSection" class="text-center mt-8 hidden">
            <button onclick="loadMore()" class="bg-teal-500 text-white px-8 py-3 rounded-xl font-semibold hover:bg-teal-600 transition">
                Load More
            </button>
        </div>
    </main>

    <div id="previewModal" class="modal-hidden fixed inset-0 bg-black/95 z-[60] items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl overflow-hidden max-w-5xl w-full shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 z-50 bg-black/70 text-white rounded-full p-2.5 hover:bg-black transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <video id="modalVideo" controls class="w-full aspect-video bg-black" src=""></video>
            <div class="p-6">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4">
                    <div class="flex-1">
                        <h3 id="modalTitle" class="text-2xl font-bold text-gray-900 mb-2"></h3>
                        <div class="flex items-center gap-2 text-sm flex-wrap mb-2">
                            <span id="modalCategory" class="px-3 py-1 bg-teal-100 text-teal-700 rounded-lg font-medium"></span>
                            <span id="modalSubcategory" class="px-3 py-1 bg-blue-100 text-blue-700 rounded-lg font-medium"></span>
                            <span id="modalSub" class="px-3 py-1 bg-purple-100 text-purple-700 rounded-lg font-medium"></span>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="text-right">
                            <p class="text-sm text-gray-500">License from</p>
                            <p class="text-3xl font-bold text-gray-900">$<span id="modalPrice"></span></p>
                        </div>
                        <button onclick="handlePurchase()" class="bg-teal-500 text-white px-8 py-3 rounded-xl font-bold hover:bg-teal-600 transition shadow-lg shadow-teal-200">
                            Buy Now
                        </button>
                    </div>
                </div>
                <p id="modalDescription" class="text-gray-600 text-sm"></p>
            </div>
        </div>
    </div>

    <div id="loginModal" class="modal">
      <div class="modal-content">
        <span class="close-modal" onclick="closeLoginModal()">&times;</span>
        <h2>Sign In to StockFlow</h2>
        <button onclick="signInWithGoogle()" style="width:100%;padding:12px;background:#4285F4;color:white;border:none;border-radius:8px;font-size:16px;font-weight:bold;cursor:pointer;margin-bottom:15px;">
          Sign in with Google
        </button>
        <p style="text-align:center;color:#999;margin:10px 0;">‚Äî or ‚Äî</p>
        <input type="email" id="authEmail" placeholder="your@email.com" style="width:100%;padding:12px;border:2px solid #14B8A6;border-radius:8px;font-size:16px;margin-bottom:10px;box-sizing:border-box;"/>
        <input type="password" id="authPassword" placeholder="Password" style="width:100%;padding:12px;border:2px solid #14B8A6;border-radius:8px;font-size:16px;margin-bottom:15px;box-sizing:border-box;"/>
        <button onclick="signInWithEmail(document.getElementById('authEmail').value, document.getElementById('authPassword').value)" style="width:100%;background:#14B8A6;color:white;padding:12px;border:none;border-radius:8px;font-size:16px;font-weight:bold;cursor:pointer;">
          Sign In / Create Account
        </button>
      </div>
    </div>

    <div id="topUpModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeTopUpModal()">&times;</span>
            <h2>Add Funds to Wallet</h2>
            <div style="display:grid;gap:15px;margin-top:15px;">
                <button onclick="addFunds(10)" class="topup-button"><span style="font-size:24px;font-weight:bold;">$10</span></button>
                <button onclick="addFunds(20)" class="topup-button"><span style="font-size:24px;font-weight:bold;">$20</span></button>
                <button onclick="addFunds(30)" class="topup-button"><span style="font-size:24px;font-weight:bold;">$30</span></button>
            </div>
        </div>
    </div>

    <div id="historyModal" class="modal">
        <div class="modal-content" style="max-width:750px; width: 95%;">
            <span class="close-modal" onclick="closeHistoryModal()">&times;</span>
            <h2 class="text-xl font-bold mb-4 border-b pb-2">My Purchases</h2>
            
            <div id="historyList" style="max-height: 400px; overflow-y: auto;">
                <p class="text-gray-500 py-4">Loading your purchase history...</p>
            </div>
            
            <p class="text-xs text-gray-400 mt-4 text-center italic">Scroll to see more purchases</p>
        </div>
    </div>

    <div id="licenseModal" class="modal">
        <div class="modal-content" style="max-width:700px;max-height:80vh;overflow-y:auto;">
            <span class="close-modal" onclick="closeLicenseModal()">&times;</span>
            <h2 style="color:#14B8A6;margin-bottom:10px;">üìú Nmediaservices Stockflow License Terms</h2>
            <div style="background:#D1FAE5;border-left:4px solid #10B981;padding:15px;margin-bottom:20px;border-radius:4px; font-size:14px;">
                <h3 style="color:#065F46;margin-top:0;font-weight:bold;">‚úÖ Permitted Uses</h3>
                <p>Social Media, Commercial Ads, Films, YouTube, Client Work, Broadcast.</p>
            </div>
            <div style="background:#FEE2E2;border-left:4px solid #EF4444;padding:15px;margin-bottom:20px;border-radius:4px; font-size:14px;">
                <h3 style="color:#991B1B;margin-top:0;font-weight:bold;">‚ùå Prohibited Uses</h3>
                <p>No Resale, No NFT minting, No redistributing on other stock sites.</p>
            </div>
            <div style="text-align:center;">
                <button onclick="closeLicenseModal()" style="background:#14B8A6;color:white;padding:12px 30px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;">I Understand</button>
            </div>
        </div>
    </div>

    <footer style="background:#1F2937;color:#9CA3AF;padding:40px 20px;margin-top:60px;">
        <div style="max-width:1200px;margin:0 auto;text-align:center;">
            <p style="margin:10px 0;">
                <a href="#" onclick="showLicenseInfo();return false;" style="color:#14B8A6;text-decoration:none;margin:0 15px;">License Terms</a>
                <a href="#" style="color:#9CA3AF;text-decoration:none;margin:0 15px;">Contact</a>
                <a href="#" style="color:#9CA3AF;text-decoration:none;margin:0 15px;">About</a>
            </p>
            <p style="margin:20px 0 0 0;font-size:14px;">¬© 2026 Nmediaservices Stockflow. All rights reserved.</p>
        </div>
    </footer>

    <script type="module" src="js/auth.js"></script>
    <script src="js/config.js"></script>
    <script src="js/modals.js"></script>
    <script src="js/videos.js"></script>
    <script src="js/wallet.js"></script>
    <script>
        init();
    </script>

</body>
</html>
