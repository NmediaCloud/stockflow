<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nmediaservices Stockflow | Premium Footage Marketplace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .video-card:hover img { transform: scale(1.05); }
        .modal-hidden { display: none; }
        .modal-visible { display: flex; }
        .category-btn.active { 
            background: #14B8A6; /* Teal-500 */
            color: white; 
        }
        .format-btn.active {
            background: #14B8A6; /* Teal-500 */
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-900">

    <!-- Navigation -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <!-- LOGO: Google Drive hosted logo -->
                <!-- Make sure this file is shared as "Anyone with the link" in Google Drive -->
                <img src="assets/logo.png"
                     alt="Nmediaservices Logo" 
                     class="h-10 w-auto max-w-[150px]"
                     onerror="console.error('Logo failed to load. Check if file is public in Google Drive')">
                <h1 class="text-xl font-bold tracking-tight text-gray-900">Nmediaservices<span class="text-teal-500">Stockflow</span></h1>
            </div>
            <div class="flex items-center gap-4">
                <a href="#" class="text-sm font-medium text-gray-600 hover:text-teal-600 transition">Explore</a>
                <a href="#" class="text-sm font-medium text-gray-600 hover:text-teal-600 transition">License</a>
                <a href="#" class="text-sm font-medium text-gray-600 hover:text-teal-600 transition">About</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section with Search -->
    <header class="bg-gradient-to-br from-teal-500 to-teal-700 text-white py-20 px-6">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-5xl font-extrabold mb-4 tracking-tight">Premium Stock Footage</h2>
            <p class="text-xl text-teal-100 mb-8">Discover high-quality videos for your creative projects</p>
            
            <!-- Search Bar -->
            <div class="relative max-w-2xl mx-auto">
                <input 
                    type="text" 
                    id="searchInput"
                    placeholder="Search for microscopic, food, beverage footage..."
                    class="w-full px-6 py-4 pr-32 rounded-full text-gray-900 text-lg focus:outline-none focus:ring-4 focus:ring-teal-300 shadow-xl"
                    oninput="filterVideos()">
                <button class="absolute right-2 top-2 bg-teal-600 text-white px-8 py-2 rounded-full font-semibold hover:bg-teal-700 transition">
                    Search
                </button>
            </div>
        </div>
    </header>

    <!-- Filters Section -->
    <div class="bg-white border-b border-gray-200 sticky top-[73px] z-40 shadow-sm">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <!-- Category Filters -->
            <div class="mb-4">
                <p class="text-sm font-semibold text-gray-600 mb-2">Categories</p>
                <div class="flex flex-wrap gap-2">
                    <button class="category-btn active px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-gray-700 hover:bg-teal-500 hover:text-white transition" 
                            data-category="all" onclick="filterByCategory('all')">
                        All
                    </button>
                    <button class="category-btn px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-gray-700 hover:bg-teal-500 hover:text-white transition" 
                            data-category="microscopic" onclick="filterByCategory('microscopic')">
                        Microscopic
                    </button>
                    <button class="category-btn px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-gray-700 hover:bg-teal-500 hover:text-white transition" 
                            data-category="food" onclick="filterByCategory('food')">
                        Food
                    </button>
                    <button class="category-btn px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-gray-700 hover:bg-teal-500 hover:text-white transition" 
                            data-category="beverage" onclick="filterByCategory('beverage')">
                        Beverage
                    </button>
                </div>
            </div>

            <!-- Format Filters -->
            <div class="flex items-center gap-4">
                <p class="text-sm font-semibold text-gray-600">Format</p>
                <div class="flex gap-2">
                    <button class="format-btn active px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-100 text-gray-700 hover:bg-teal-500 hover:text-white transition flex items-center gap-1" 
                            data-format="all" onclick="filterByFormat('all')">
                        All
                    </button>
                    <button class="format-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-100 text-gray-700 hover:bg-teal-500 hover:text-white transition flex items-center gap-1" 
                            data-format="9:16" onclick="filterByFormat('9:16')">
                        <span class="text-[10px]">üì±</span> 9:16
                    </button>
                    <button class="format-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-100 text-gray-700 hover:bg-teal-500 hover:text-white transition flex items-center gap-1" 
                            data-format="16:9" onclick="filterByFormat('16:9')">
                        <span class="text-[10px]">üñ•Ô∏è</span> 16:9
                    </button>
                    <button class="format-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-100 text-gray-700 hover:bg-teal-500 hover:text-white transition flex items-center gap-1" 
                            data-format="1:1" onclick="filterByFormat('1:1')">
                        <span class="text-[10px]">‚¨ú</span> 1:1
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Message -->
    <div class="max-w-7xl mx-auto px-6 py-4">
        <p id="status-text" class="text-sm text-gray-500">
            <span class="inline-block w-2 h-2 bg-teal-500 rounded-full animate-pulse mr-2"></span>
            Loading footage...
        </p>
    </div>

    <!-- Video Grid -->
    <main class="max-w-7xl mx-auto px-6 pb-16">
        <div id="video-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        </div>
    </main>

    <!-- Preview Modal -->
    <div id="previewModal" class="modal-hidden fixed inset-0 bg-black/95 z-[60] items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl overflow-hidden max-w-5xl w-full shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 z-50 bg-black/70 text-white rounded-full p-2.5 hover:bg-black transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            
            <video id="modalVideo" controls class="w-full aspect-video bg-black" src=""></video>
            
            <div class="p-6">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4">
                    <div>
                        <h3 id="modalTitle" class="text-2xl font-bold text-gray-900 mb-1">Video Title</h3>
                        <div class="flex items-center gap-3 text-sm flex-wrap">
                            <span id="modalCategory" class="px-2 py-1 bg-teal-100 text-teal-700 rounded-md font-medium">Category</span>
                            <span id="modalFormat" class="text-gray-600">16:9</span>
                            <span id="modalResolution" class="text-gray-600">4K</span>
                        </div>
                        <!-- Tags display -->
                        <div id="modalTags" class="flex flex-wrap gap-1 mt-2"></div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="text-right">
                            <p class="text-sm text-gray-500">License from</p>
                            <p class="text-3xl font-bold text-gray-900">$<span id="modalPrice">10</span></p>
                        </div>
                        <button onclick="handlePurchase()" class="bg-teal-500 text-white px-8 py-3 rounded-xl font-bold hover:bg-teal-600 transition shadow-lg shadow-teal-200">
                            Buy Now
                        </button>
                    </div>
                </div>
                <p id="modalDescription" class="text-gray-600 text-sm"></p>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const PUBLISHED_SHEET_ID = '2PACX-1vSP5OJpICPPpGYxgeuVcpJdx8nR7LKqLTpDAWBlhLKUgZDafXqZ_tTpa8_1fM1bVHdBYGlorZxfiW8_';
        const SHEET_CSV_URL = `https://docs.google.com/spreadsheets/d/e/${PUBLISHED_SHEET_ID}/pub?output=csv`;

        let allVideos = [];
        let filteredVideos = [];
        let currentCategory = 'all';
        let currentFormat = 'all';
        let currentVideo = null;

        // CSV Parser
        function parseCSV(text) {
            const lines = text.split('\n');
            const result = [];
            
            for (let line of lines) {
                if (!line.trim()) continue;
                
                const values = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                values.push(current.trim());
                result.push(values);
            }
            
            return result;
        }

        async function init() {
            const grid = document.getElementById('video-grid');
            const status = document.getElementById('status-text');

            try {
                const response = await fetch(SHEET_CSV_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const csvText = await response.text();
                const rows = parseCSV(csvText);

                console.log('‚úÖ Loaded', rows.length - 1, 'videos');

                // Parse data - CSV structure with Tags column
                allVideos = [];
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    
                    if (!row || row.length < 2 || !row[1]) continue;

                    const video = {
                        id: row[0] || i.toString(),
                        title: row[1] || "Untitled",
                        category: row[2] || "General",
                        description: row[3] || "",
                        thumb: row[4] || "",
                        preview: row[5] || "",
                        highres: row[6] || "",
                        price: row[7] || "10",
                        format: row[8] || "16:9",
                        resolution: row[9] || "4K",
                        tags: row[10] || ""  // NEW: Tags column
                    };

                    allVideos.push(video);
                }

                filteredVideos = [...allVideos];
                renderVideos();

                status.innerHTML = `<span class="inline-block w-2 h-2 bg-green-500 rounded-full mr-2"></span>${allVideos.length} videos loaded`;

            } catch (error) {
                console.error("‚ùå Error:", error);
                status.innerHTML = `<span class="inline-block w-2 h-2 bg-red-500 rounded-full mr-2"></span>Failed to load footage`;
                
                grid.innerHTML = `
                    <div class="col-span-full bg-red-50 border border-red-200 rounded-xl p-8 text-center">
                        <h3 class="text-red-800 font-bold text-lg mb-2">Connection Error</h3>
                        <p class="text-red-600 text-sm">Unable to load videos from Google Sheets. Please check your connection.</p>
                    </div>
                `;
            }
        }

        function renderVideos() {
            const grid = document.getElementById('video-grid');
            grid.innerHTML = '';

            if (filteredVideos.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-16">
                        <p class="text-gray-400 text-lg">No videos match your filters</p>
                    </div>
                `;
                return;
            }

            filteredVideos.forEach(video => {
                const card = document.createElement('div');
                card.className = "video-card bg-white rounded-xl overflow-hidden shadow-sm hover:shadow-xl transition-all cursor-pointer group";
                
                card.innerHTML = `
                    <div class="relative aspect-video bg-gray-100 overflow-hidden">
                        <img src="${video.thumb}" 
                             class="w-full h-full object-cover transition-transform duration-500" 
                             alt="${video.title}"
                             onerror="this.src='https://placehold.co/600x400/14B8A6/FFFFFF?text=${encodeURIComponent(video.title)}'">
                        <div class="absolute inset-0 flex items-center justify-center bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity">
                            <div class="bg-white/95 p-4 rounded-full shadow-xl">
                                <svg class="w-8 h-8 text-teal-500 ml-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="absolute top-2 right-2 px-2 py-1 bg-black/70 text-white text-xs font-semibold rounded">
                            ${video.format}
                        </div>
                    </div>
                    <div class="p-4">
                        <h4 class="font-bold text-gray-800 text-base mb-2 line-clamp-1">${video.title}</h4>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-teal-600 font-semibold uppercase tracking-wide">${video.category}</span>
                            <span class="font-bold text-gray-900 text-lg">$${video.price}</span>
                        </div>
                    </div>
                `;

                card.onclick = () => openModal(video);
                grid.appendChild(card);
            });
        }

        function filterByCategory(category) {
            currentCategory = category;
            
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            applyFilters();
        }

        function filterByFormat(format) {
            currentFormat = format;
            
            document.querySelectorAll('.format-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            applyFilters();
        }

        function filterVideos() {
            applyFilters();
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            filteredVideos = allVideos.filter(video => {
                const matchesCategory = currentCategory === 'all' || 
                    video.category.toLowerCase() === currentCategory.toLowerCase();
                
                const matchesFormat = currentFormat === 'all' || 
                    video.format === currentFormat;
                
                const matchesSearch = !searchTerm || 
                    video.title.toLowerCase().includes(searchTerm) ||
                    video.category.toLowerCase().includes(searchTerm) ||
                    video.description.toLowerCase().includes(searchTerm) ||
                    video.tags.toLowerCase().includes(searchTerm);  // Search includes tags
                
                return matchesCategory && matchesFormat && matchesSearch;
            });
            
            renderVideos();
        }

        function openModal(video) {
            currentVideo = video;
            const modal = document.getElementById('previewModal');
            const videoPlayer = document.getElementById('modalVideo');
            
            document.getElementById('modalTitle').innerText = video.title;
            document.getElementById('modalCategory').innerText = video.category;
            document.getElementById('modalFormat').innerText = video.format;
            document.getElementById('modalResolution').innerText = video.resolution;
            document.getElementById('modalPrice').innerText = video.price;
            document.getElementById('modalDescription').innerText = video.description;
            
            // Display tags
            const tagsContainer = document.getElementById('modalTags');
            tagsContainer.innerHTML = '';
            if (video.tags) {
                const tagArray = video.tags.split(',').map(t => t.trim()).filter(t => t);
                tagArray.forEach(tag => {
                    const tagEl = document.createElement('span');
                    tagEl.className = 'px-2 py-0.5 bg-gray-100 text-gray-600 rounded text-xs';
                    tagEl.innerText = tag;
                    tagsContainer.appendChild(tagEl);
                });
            }
            
            if (video.preview) {
                videoPlayer.src = video.preview;
                modal.classList.remove('modal-hidden');
                modal.classList.add('modal-visible');
                videoPlayer.play().catch(err => console.warn('Autoplay prevented'));
            } else {
                alert('Preview not available');
            }
        }

        function closeModal() {
            const modal = document.getElementById('previewModal');
            const videoPlayer = document.getElementById('modalVideo');
            videoPlayer.pause();
            videoPlayer.src = "";
            modal.classList.remove('modal-visible');
            modal.classList.add('modal-hidden');
        }

        function handlePurchase() {
            alert(`Payment integration coming soon!\n\nYou selected: ${currentVideo.title}\nPrice: $${currentVideo.price}\nHigh-res file: ${currentVideo.highres}`);
        }

        // Close modal on escape
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        // Initialize
        init();
    </script>
</body>
</html>



